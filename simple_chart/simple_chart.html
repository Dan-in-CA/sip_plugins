$def with(settings)

$var title: $_('SIP Simple Chart')
$var page: simple_chart
<script>
  // Initialize behaviors
  jQuery(document).ready(function(){
      jQuery("button#cConfig").click(function(){
          window.location="/simple_chart_config";
      });

      jQuery("button#cCancel").click(function(){
          window.location="/";
      });

      jQuery("button#docButton").click(function(){
          window.open("static/docs/plugins/simple_chart-docs.html", "_blank");
      });
  });

  function convertStrToInt(d) {
      var conv = {}
      for (const [key, value] of Object.entries(d)) {
          conv[key] = +value;
          if (isNaN(conv[key])) {
              conv[key] = value;
          }
      }
      return conv
  }


</script>

<script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/d3@7.8.5/dist/d3.min.js"></script>

<script src="https://cdn.jsdelivr.net/npm/luxon@3.4.4/build/global/luxon.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/chartjs-adapter-luxon@1.3.1/dist/chartjs-adapter-luxon.umd.min.js"></script>

<div id="plugin">
  <div class="title">Simple Chart
    <button class="execute" id="docButton" type="button" >$_('Help')</button>
  </div>
  $#{settings}


    $for chart in settings:
      $if "enabled" in settings[chart]:
        <canvas id="chart_${loop.index}"></canvas>

        <script>
          var files = $:settings[chart]["data"]
          var promises_${loop.index} = []
          for (i in files) {
              promises_${loop.index}.push(d3.csv(files[i], function(d) {return convertStrToInt(d)}))
          }

          Promise.all(
              promises_${loop.index}
          ).then(function(csv_data){
              chart_${loop.index}(csv_data)
          }).catch(function(err){
              console.log(err)
          })

          function chart_${loop.index}(csv_data) {
              var datasets = []
              for (i in files) {
                  // Remove extension and path
                  label = files[i].replace(/\.[^/.]+$$/, "");
                  label = label.split("/").pop()
                  datasets.push({ data: csv_data[i], label: label});
              }

              var chart = new Chart("chart_${loop.index}", {
                  type: "line",
                  data: {
                      datasets: datasets,
                  },
                  options: $:settings[chart]["options"],
              })
          }
        </script>


  </br>
  <div class="controls">
    <button id="cConfig" class="execute">$_('Config')</button>
    <button id="cCancel" class="cancel danger">$_('Cancel')</button>
  </div>
</div>
